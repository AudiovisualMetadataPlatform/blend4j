<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_51) on Tue Jul 15 20:41:50 CDT 2014 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>Overview (blend4j 0.2.0-SNAPSHOT API)</title>
<meta name="date" content="2014-07-15">
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="Overview (blend4j 0.2.0-SNAPSHOT API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<script type="text/javascript">           var fileref=document.createElement("link");           fileref.setAttribute("rel", "stylesheet");           fileref.setAttribute("type", "text/css");           fileref.setAttribute("href", "resources/syntaxhighlighterstyle.css");           document.getElementsByTagName("head")[0].appendChild(fileref);           </script>           <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>           <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js" type="text/javascript"></script>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li class="navBarCell1Rev">Overview</li>
<li>Package</li>
<li>Class</li>
<li>Use</li>
<li><a href="overview-tree.html">Tree</a></li>
<li><a href="deprecated-list.html">Deprecated</a></li>
<li><a href="index-all.html">Index</a></li>
<li><a href="help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev</li>
<li>Next</li>
</ul>
<ul class="navList">
<li><a href="index.html?overview-summary.html" target="_top">Frames</a></li>
<li><a href="overview-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 class="title">blend4j 0.2.0-SNAPSHOT API</h1>
</div>
<div class="header">
<div class="subTitle">
<div class="block">blend4j is a partial reimplemenation of the Python library <a
href="https://github.com/afgane/bioblend">bioblend</a> for the JVM.</div>
</div>
<p>See: <a href="#overview_description">Description</a></p>
</div>
<div class="contentContainer">
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Packages table, listing packages, and an explanation">
<caption><span>Packages</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Package</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="com/github/jmchilton/blend4j/package-summary.html">com.github.jmchilton.blend4j</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="com/github/jmchilton/blend4j/galaxy/package-summary.html">com.github.jmchilton.blend4j.galaxy</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="com/github/jmchilton/blend4j/galaxy/beans/package-summary.html">com.github.jmchilton.blend4j.galaxy.beans</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="com/github/jmchilton/blend4j/toolshed/package-summary.html">com.github.jmchilton.blend4j.toolshed</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="com/github/jmchilton/blend4j/toolshed/beans/package-summary.html">com.github.jmchilton.blend4j.toolshed.beans</a></td>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
<div class="footer"><a name="overview_description">
<!--   -->
</a>
<div class="subTitle">
<div class="block"><p>blend4j is a partial reimplemenation of the Python library <a
href="https://github.com/afgane/bioblend">bioblend</a> for the JVM. bioblend
for Python is a library for scripting interactions with Galaxy. These API
documents describe how to use it - for general information including how to
obtain and test blend4j checkout its home on <a
href="https://github.com/jmchilton/blend4j">github</a>.</p>

<h2>Examples</h2>

<p>These examples demonstrate some simple use cases - see specific packages and classes for more details.</p>
<p>To tell blend4j which Galaxy instance and API key to use, you can put a .blend.properties file in your home directory:</p>
<ul>
    <li>test.galaxy.instance=https://usegalaxy.org/</li>
    <li>test.galaxy.key=7cb.........................79fc (put your API key in here)</li>
</ul>
<p>For simplicity, these examples assume the following import statements are used to import all of blend4j's Galaxy functionality.</p>

<pre class="brush:java">
import com.github.jmchilton.blend4j.galaxy.beans.*;
import com.github.jmchilton.blend4j.galaxy.*;
</pre>

<p>Listing current users history:</p>

<pre class="brush:java">
  GalaxyInstance galaxyInstance = GalaxyInstanceFactory.get(url, apiKey);
  HistoriesClient historiesClient = galaxyInstance.getHistoriesClient();
  for(History history : historiesClient.getHistories()) {
    String name = history.getName();
    String id = history.getId();
    String message = String.format("Found history with name %s and id %s", name, id);
    System.out.println(message);
  }
</pre>

<p>Find a data library by name and print its contents:</p>

<pre class="brush:java">
  final GalaxyInstance galaxyInstance = GalaxyInstanceFactory.get(url, apiKey);
  final LibrariesClient librariesClient = galaxyInstance.getLibrariesClient();
  final List&lt;Library&gt; libraries = librariesClient.getLibraries();
  Library testLibrary = null;
  for(final Library library : libraries) {
    if(library.getName().equals("test-library")) {
      testLibrary = library;
    }
  }
  if(testLibrary == null) {
    return;
  }
  for(final LibraryContent content : librariesClient.getLibraryContents(testLibrary.getId())) {
    final String type = content.getType(); // file or folder
    final String name = content.getName();
    final String id = content.getId();
    final String message = String.format("Found library content of type %s with name %s and id %s", type, name, id);
    System.out.println(message);
  }
</pre>

<p>The following code demonstrates running a workflow. It assumes the existence of
a workflow named TestWorkflow1 with two inputs labeled WorkflowInput1 and 
WorkflowInput2. Additionally it assumes a history named TestHistory1 already
exists containing two datasets Input1 and Input2.</p>

<pre class="brush:java">
final GalaxyInstance instance = GalaxyInstanceFactory.get(url, apiKey);
final WorkflowsClient workflowsClient = instance.getWorkflowsClient();

// Find history
final HistoriesClient historyClient = instance.getHistoriesClient();
History matchingHistory = null;
for(final History history : historyClient.getHistories()) {
  if(history.getName().equals("TestHistory1")) {
    matchingHistory = history;
  }
}
Assert.assertNotNull(matchingHistory);
String input1Id = null;
String input2Id = null;
for(final HistoryContents historyDataset :historyClient.showHistoryContents(matchingHistory.getId())) {
  if(historyDataset.getName().equals("Input1")) {
    input1Id = historyDataset.getId();
  }
  if(historyDataset.getName().equals("Input2")) {
    input2Id = historyDataset.getId();
  }
}

Workflow matchingWorkflow = null;
for(Workflow workflow : workflowsClient.getWorkflows()) {
  if(workflow.getName().equals("TestWorkflow1")) {
    matchingWorkflow = workflow;
  }
}

final WorkflowDetails workflowDetails = workflowsClient.showWorkflow(matchingWorkflow.getId());
String workflowInput1Id = null;
String workflowInput2Id = null;
for(final Map.Entry&lt;String, WorkflowInputDefinition&gt; inputEntry : workflowDetails.getInputs().entrySet()) {
  final String label = inputEntry.getValue().getLabel();
  if(label.equals("WorkflowInput1")) {
    workflowInput1Id = inputEntry.getKey();
  }
  if(label.equals("WorkflowInput2")) {
    workflowInput2Id = inputEntry.getKey();
  }
}

final WorkflowInputs inputs = new WorkflowInputs();
inputs.setDestination(new WorkflowInputs.ExistingHistory(matchingHistory.getId()));
inputs.setWorkflowId(matchingWorkflow.getId());
inputs.setInput(workflowInput1Id, new WorkflowInputs.WorkflowInput(input1Id, WorkflowInputs.InputSourceType.HDA));
inputs.setInput(workflowInput2Id, new WorkflowInputs.WorkflowInput(input2Id, WorkflowInputs.InputSourceType.HDA));
final WorkflowOutputs output = workflowsClient.runWorkflow(inputs);    
System.out.println("Running workflow in history " + output.getHistoryId());
for(String outputId : output.getOutputIds()) {
  System.out.println("  Workflow writing to output id " + outputId);
}
</pre>

<p>The following code demonstrates creating a data library at four different levels of abstraction (these examples require an admin key):</p>
  
<pre class="brush:java">
// Most API methods have corresponding blend4j methods for dealing with 
// both low-level request and parsed POJO responses. You can also use the method
// galaxyInstance.getWebResource() to access the low-level Jersey APIs directly.
final GalaxyInstance galaxyInstance = GalaxyInstanceFactory.get(url, apiKey);
final LibrariesClient librariesClient = galaxyInstance.getLibrariesClient(); 

// Highest level of abstraction, deal with POJO responses
final Library testLibrary1 = new Library("test1");
final Library persistedLibrary1 = librariesClient.createLibrary(testLibrary1);

// Deal with Jersey ClientResponse object in case want to check return status, etc...
final Library testLibrary2 = new Library("test2");
final ClientResponse response2 = librariesClient.createLibraryRequest(testLibrary2);
if(response2.getStatus() == 200) {
  final Library persistedLibrary2 = response2.getEntity(Library.class); 
  // ...
}

// Use Jersey directly (with POJOs)
final WebResource webResource3 = galaxyInstance.getWebResource();
final Library testLibrary3 = new Library("test3");
final ClientResponse response3 = webResource3
    .path("libraries")
    .type(MediaType.APPLICATION_JSON)
    .accept(MediaType.APPLICATION_JSON)
    .post(ClientResponse.class, testLibrary3);
final Library persistedLibrary3 = response3.getEntity(Library.class);

// Use Jersey directly (no POJOs)
final WebResource webResource4 = galaxyInstance.getWebResource();
final ClientResponse response4 = webResource4
    .path("libraries")
    .type(MediaType.APPLICATION_JSON)
    .accept(MediaType.APPLICATION_JSON)
    .post(ClientResponse.class, "{\"name\": \"test4\"}");
final String jsonResponse4 = response4.getEntity(String.class);
System.out.println("JSON response is: " + jsonResponse4);
</pre>

<p>This example demonstrates an admin process creating a private data library for a user and copying a directories contents to it. This example requires both an admin key and for use<em>remote</em>user to be enabled in the Galaxy instance's options file.</p>

<pre class="brush:java">
final GalaxyInstance galaxyInstance = GalaxyInstanceFactory.get(url, apiKey);
final String email = "alice@example.com";

// Create data library
final Library library = new Library("Example library for " + email);
final LibrariesClient librariesClient = galaxyInstance.getLibrariesClient();
final Library persistedLibrary = librariesClient.createLibrary(library);

// Copy example directory into library
final FilesystemPathsLibraryUpload upload = new FilesystemPathsLibraryUpload();
final LibraryContent rootFolder = librariesClient.getRootFolder(persistedLibrary.getId());
upload.setFolderId(rootFolder.getId());
upload.setContent("test-data/variant_detection");
librariesClient.uploadFilesystemPathsRequest(persistedLibrary.getId(), upload);

// Obtain user object
User owner = null;
final UsersClient usersClient = galaxyInstance.getUsersClient();
for(final User user : usersClient.getUsers()) {
  if(user.getEmail().equals(email)) {
    owner = user;
    break;
  }
}
if(owner == null) {
  // In order to create users like this - use_remote_user must be enabled
  // in the Galaxy instance's universe_wsgi.ini options.
  owner = usersClient.createUser(email);
}

// Obtain user role
Role ownersPrivateRole = null;
final RolesClient rolesClient = galaxyInstance.getRolesClient();
for(final Role role : rolesClient.getRoles()) {
  if(role.getName().equals(email)) {
    ownersPrivateRole = role;
    break;
  }
}
final String ownersPrivateRoleId = ownersPrivateRole.getId(); 

// Set data library permissions
final LibraryPermissions permissions = new LibraryPermissions();
permissions.getAccessInRoles().add(ownersPrivateRoleId);
permissions.getAddInRoles().add(ownersPrivateRoleId);
permissions.getManageInRoles().add(ownersPrivateRoleId);
permissions.getModifyInRoles().add(ownersPrivateRoleId);
librariesClient.setLibraryPermissions(persistedLibrary.getId(), permissions);
</pre>

<p>These examples are taken from <a href="https://github.com/jmchilton/blend4j/blob/master/src/test/java/com/github/jmchilton/blend4j/galaxy/Examples.java">Examples.java</a>. For more examples see these <a href="https://github.com/jmchilton/blend4j/blob/master/src/test/java/com/github/jmchilton/blend4j/galaxy/IntegrationTest.java">integration test cases</a> or the rest of the integration tests <a href="https://github.com/jmchilton/blend4j/blob/master/src/test/java/com/github/jmchilton/blend4j/galaxy">here</a>.</p>

<p>Brad Chapman has put together a higher-level Clojure library - <a href="https://github.com/chapmanb/clj-blend.git">clj-blend</a>, the
source code of which can serve as additional examples of blend4j
usage.</p></div>
</div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li class="navBarCell1Rev">Overview</li>
<li>Package</li>
<li>Class</li>
<li>Use</li>
<li><a href="overview-tree.html">Tree</a></li>
<li><a href="deprecated-list.html">Deprecated</a></li>
<li><a href="index-all.html">Index</a></li>
<li><a href="help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><em><script type="text/javascript">           SyntaxHighlighter.defaults["auto-links"] = false;           SyntaxHighlighter.defaults["tab-size"] = 2;           SyntaxHighlighter.all();           </script></em></div>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev</li>
<li>Next</li>
</ul>
<ul class="navList">
<li><a href="index.html?overview-summary.html" target="_top">Frames</a></li>
<li><a href="overview-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2014. All rights reserved.</small></p>
</body>
</html>
